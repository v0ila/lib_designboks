!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.opentype=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){},{}],2:[function(_dereq_,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!=="undefined"&&window.setImmediate;var canPost=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}if(canPost){var queue=[];window.addEventListener("message",function(ev){var source=ev.source;if((source===window||source===null)&&ev.data==="process-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage("process-tick","*")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title="browser";process.browser=true;process.env={};process.argv=[];function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")}},{}],3:[function(_dereq_,module,exports){"use strict";exports.argument=function(predicate,message){if(!predicate){throw new Error(message)}};exports.assert=exports.argument},{}],4:[function(_dereq_,module,exports){"use strict";function line(ctx,x1,y1,x2,y2){ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke()}exports.line=line},{}],5:[function(_dereq_,module,exports){"use strict";var cffStandardStrings=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"];var cffStandardEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"];var cffExpertEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"];var standardNames=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function DefaultEncoding(font){this.font=font}DefaultEncoding.prototype.charToGlyphIndex=function(c){var code,glyphs,i,glyph,j;code=c.charCodeAt(0);glyphs=this.font.glyphs;if(glyphs){for(i=0;i<glyphs.length;i+=1){glyph=glyphs[i];for(j=0;j<glyph.unicodes.length;j+=1){if(glyph.unicodes[j]===code){return i}}}}else{return null}};function CmapEncoding(cmap){this.cmap=cmap}CmapEncoding.prototype.charToGlyphIndex=function(c){return this.cmap.glyphIndexMap[c.charCodeAt(0)]||0};function CffEncoding(encoding,charset){this.encoding=encoding;this.charset=charset}CffEncoding.prototype.charToGlyphIndex=function(s){var code,charName;code=s.charCodeAt(0);charName=this.encoding[code];return this.charset.indexOf(charName)};function GlyphNames(post){var i;switch(post.version){case 1:this.names=exports.standardNames.slice();break;case 2:this.names=new Array(post.numberOfGlyphs);for(i=0;i<post.numberOfGlyphs;i++){if(post.glyphNameIndex[i]<exports.standardNames.length){this.names[i]=exports.standardNames[post.glyphNameIndex[i]]}else{this.names[i]=post.names[post.glyphNameIndex[i]-exports.standardNames.length]}}break;case 2.5:this.names=new Array(post.numberOfGlyphs);for(i=0;i<post.numberOfGlyphs;i++){this.names[i]=exports.standardNames[i+post.glyphNameIndex[i]]}break}}GlyphNames.prototype.nameToGlyphIndex=function(name){return this.names.indexOf(name)};GlyphNames.prototype.glyphIndexToName=function(gid){return this.names[gid]};function addGlyphNames(font){var glyphIndexMap,charCodes,i,c,glyphIndex,glyph;glyphIndexMap=font.tables.cmap.glyphIndexMap;charCodes=Object.keys(glyphIndexMap);for(i=0;i<charCodes.length;i+=1){c=charCodes[i];glyphIndex=glyphIndexMap[c];glyph=font.glyphs[glyphIndex];glyph.addUnicode(parseInt(c))}for(i=0;i<font.glyphs.length;i+=1){glyph=font.glyphs[i];if(font.cffEncoding){glyph.name=font.cffEncoding.charset[i]}else{glyph.name=font.glyphNames.glyphIndexToName(i)}}}exports.cffStandardStrings=cffStandardStrings;exports.cffStandardEncoding=cffStandardEncoding;exports.cffExpertEncoding=cffExpertEncoding;exports.standardNames=standardNames;exports.DefaultEncoding=DefaultEncoding;exports.CmapEncoding=CmapEncoding;exports.CffEncoding=CffEncoding;exports.GlyphNames=GlyphNames;exports.addGlyphNames=addGlyphNames},{}],6:[function(_dereq_,module,exports){"use strict";var path=_dereq_("./path");var sfnt=_dereq_("./tables/sfnt");var encoding=_dereq_("./encoding");function Font(options){options=options||{};this.familyName=options.familyName||" ";this.styleName=options.styleName||" ";this.designer=options.designer||" ";this.designerURL=options.designerURL||" ";this.manufacturer=options.manufacturer||" ";this.manufacturerURL=options.manufacturerURL||" ";this.license=options.license||" ";this.licenseURL=options.licenseURL||" ";this.version=options.version||"Version 0.1";this.description=options.description||" ";this.copyright=options.copyright||" ";this.trademark=options.trademark||" ";this.unitsPerEm=options.unitsPerEm||1e3;this.supported=true;this.glyphs=options.glyphs||[];this.encoding=new encoding.DefaultEncoding(this);this.tables={}}Font.prototype.hasChar=function(c){return this.encoding.charToGlyphIndex(c)!==null};Font.prototype.charToGlyphIndex=function(s){return this.encoding.charToGlyphIndex(s)};Font.prototype.charToGlyph=function(c){var glyphIndex,glyph;glyphIndex=this.charToGlyphIndex(c);glyph=this.glyphs[glyphIndex];if(!glyph){glyph=this.glyphs[0]}return glyph};Font.prototype.stringToGlyphs=function(s){var i,c,glyphs;glyphs=[];for(i=0;i<s.length;i+=1){c=s[i];glyphs.push(this.charToGlyph(c))}return glyphs};Font.prototype.nameToGlyphIndex=function(name){return this.glyphNames.nameToGlyphIndex(name)};Font.prototype.nameToGlyph=function(name){var glyphIndex,glyph;glyphIndex=this.nametoGlyphIndex(name);glyph=this.glyphs[glyphIndex];if(!glyph){glyph=this.glyphs[0]}return glyph};Font.prototype.glyphIndexToName=function(gid){if(!this.glyphNames.glyphIndexToName){return""}return this.glyphNames.glyphIndexToName(gid)};Font.prototype.getKerningValue=function(leftGlyph,rightGlyph){leftGlyph=leftGlyph.index||leftGlyph;rightGlyph=rightGlyph.index||rightGlyph;var gposKerning=this.getGposKerningValue;return gposKerning?gposKerning(leftGlyph,rightGlyph):this.kerningPairs[leftGlyph+","+rightGlyph]||0};Font.prototype.forEachGlyph=function(text,x,y,fontSize,options,callback){var kerning,fontScale,glyphs,i,glyph,kerningValue;if(!this.supported){return}x=x!==undefined?x:0;y=y!==undefined?y:0;fontSize=fontSize!==undefined?fontSize:72;options=options||{};kerning=options.kerning===undefined?true:options.kerning;fontScale=1/this.unitsPerEm*fontSize;glyphs=this.stringToGlyphs(text);for(i=0;i<glyphs.length;i+=1){glyph=glyphs[i];callback(glyph,x,y,fontSize,options);if(glyph.advanceWidth){x+=glyph.advanceWidth*fontScale}if(kerning&&i<glyphs.length-1){kerningValue=this.getKerningValue(glyph,glyphs[i+1]);x+=kerningValue*fontScale}}};Font.prototype.getPath=function(text,x,y,fontSize,options){var fullPath=new path.Path;this.forEachGlyph(text,x,y,fontSize,options,function(glyph,x,y,fontSize){var path=glyph.getPath(x,y,fontSize);fullPath.extend(path)});return fullPath};Font.prototype.draw=function(ctx,text,x,y,fontSize,options){this.getPath(text,x,y,fontSize,options).draw(ctx)};Font.prototype.drawPoints=function(ctx,text,x,y,fontSize,options){this.forEachGlyph(text,x,y,fontSize,options,function(glyph,x,y,fontSize){glyph.drawPoints(ctx,x,y,fontSize)})};Font.prototype.drawMetrics=function(ctx,text,x,y,fontSize,options){this.forEachGlyph(text,x,y,fontSize,options,function(glyph,x,y,fontSize){glyph.drawMetrics(ctx,x,y,fontSize)})};Font.prototype.validate=function(){var warnings=[];var font=this;function assert(predicate,message){if(!predicate){warnings.push(message)}}function assertStringAttribute(attrName){assert(font[attrName]&&font[attrName].trim().length>0,"No "+attrName+" specified.")}assertStringAttribute("familyName");assertStringAttribute("weightName");assertStringAttribute("manufacturer");assertStringAttribute("copyright");assertStringAttribute("version");assert(this.unitsPerEm>0,"No unitsPerEm specified.")};Font.prototype.toTables=function(){return sfnt.fontToTable(this)};Font.prototype.toBuffer=function(){var sfntTable=this.toTables();var bytes=sfntTable.encode();var buffer=new ArrayBuffer(bytes.length);var intArray=new Uint8Array(buffer);for(var i=0;i<bytes.length;i++){intArray[i]=bytes[i]}return buffer};Font.prototype.download=function(){var fileName=this.familyName.replace(/\s/g,"")+"-"+this.styleName+".otf";var buffer=this.toBuffer();window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;window.requestFileSystem(window.TEMPORARY,buffer.byteLength,function(fs){fs.root.getFile(fileName,{create:true},function(fileEntry){fileEntry.createWriter(function(writer){var dataView=new DataView(buffer);var blob=new Blob([dataView],{type:"font/opentype"});writer.write(blob);writer.addEventListener("writeend",function(){location.href=fileEntry.toURL()},false)})})},function(err){throw err})};exports.Font=Font},{"./encoding":5,"./path":10,"./tables/sfnt":25}],7:[function(_dereq_,module,exports){"use strict";var check=_dereq_("./check");var draw=_dereq_("./draw");var path=_dereq_("./path");function Glyph(options){this.font=options.font||null;this.index=options.index||0;this.name=options.name||null;this.unicode=options.unicode||undefined;this.unicodes=options.unicodes||options.unicode!==undefined?[options.unicode]:[];this.xMin=options.xMin||0;this.yMin=options.yMin||0;this.xMax=options.xMax||0;this.yMax=options.yMax||0;this.advanceWidth=options.advanceWidth||0;this.path=options.path||null}Glyph.prototype.addUnicode=function(unicode){if(this.unicodes.length===0){this.unicode=unicode}this.unicodes.push(unicode)};Glyph.prototype.getPath=function(x,y,fontSize){var scale,p,commands,cmd;x=x!==undefined?x:0;y=y!==undefined?y:0;fontSize=fontSize!==undefined?fontSize:72;scale=1/this.font.unitsPerEm*fontSize;p=new path.Path;commands=this.path.commands;for(var i=0;i<commands.length;i+=1){cmd=commands[i];if(cmd.type==="M"){p.moveTo(x+cmd.x*scale,y+-cmd.y*scale)}else if(cmd.type==="L"){p.lineTo(x+cmd.x*scale,y+-cmd.y*scale)}else if(cmd.type==="Q"){p.quadraticCurveTo(x+cmd.x1*scale,y+-cmd.y1*scale,x+cmd.x*scale,y+-cmd.y*scale)}else if(cmd.type==="C"){p.curveTo(x+cmd.x1*scale,y+-cmd.y1*scale,x+cmd.x2*scale,y+-cmd.y2*scale,x+cmd.x*scale,y+-cmd.y*scale)}else if(cmd.type==="Z"){p.closePath()}}return p};Glyph.prototype.getContours=function(){var contours,currentContour,i,pt;if(this.points===undefined){return[]}contours=[];currentContour=[];for(i=0;i<this.points.length;i+=1){pt=this.points[i];currentContour.push(pt);if(pt.lastPointOfContour){contours.push(currentContour);currentContour=[]}}check.argument(currentContour.length===0,"There are still points left in the current contour.");return contours};Glyph.prototype.getMetrics=function(){var commands=this.path.commands;var xCoords=[];var yCoords=[];for(var i=0;i<commands.length;i+=1){var cmd=commands[i];if(cmd.type!=="Z"){xCoords.push(cmd.x);yCoords.push(cmd.y)}if(cmd.type==="Q"||cmd.type==="C"){xCoords.push(cmd.x1);yCoords.push(cmd.y1)}if(cmd.type==="C"){xCoords.push(cmd.x2);yCoords.push(cmd.y2)}}var metrics={xMin:Math.min.apply(null,xCoords),yMin:Math.min.apply(null,yCoords),xMax:Math.max.apply(null,xCoords),yMax:Math.max.apply(null,yCoords),leftSideBearing:0};metrics.rightSideBearing=this.advanceWidth-metrics.leftSideBearing-(metrics.xMax-metrics.xMin);return metrics};Glyph.prototype.draw=function(ctx,x,y,fontSize){this.getPath(x,y,fontSize).draw(ctx)};Glyph.prototype.drawPoints=function(ctx,x,y,fontSize){function drawCircles(l,x,y,scale){var j,PI_SQ=Math.PI*2;ctx.beginPath();for(j=0;j<l.length;j+=1){ctx.moveTo(x+l[j].x*scale,y+l[j].y*scale);ctx.arc(x+l[j].x*scale,y+l[j].y*scale,2,0,PI_SQ,false)}ctx.closePath();ctx.fill()}var scale,i,blueCircles,redCircles,path,cmd;x=x!==undefined?x:0;y=y!==undefined?y:0;fontSize=fontSize!==undefined?fontSize:24;scale=1/this.font.unitsPerEm*fontSize;blueCircles=[];redCircles=[];path=this.path;for(i=0;i<path.commands.length;i+=1){cmd=path.commands[i];if(cmd.x!==undefined){blueCircles.push({x:cmd.x,y:-cmd.y})}if(cmd.x1!==undefined){redCircles.push({x:cmd.x1,y:-cmd.y1})}if(cmd.x2!==undefined){redCircles.push({x:cmd.x2,y:-cmd.y2})}}ctx.fillStyle="blue";drawCircles(blueCircles,x,y,scale);ctx.fillStyle="red";drawCircles(redCircles,x,y,scale)};Glyph.prototype.drawMetrics=function(ctx,x,y,fontSize){var scale;x=x!==undefined?x:0;y=y!==undefined?y:0;fontSize=fontSize!==undefined?fontSize:24;scale=1/this.font.unitsPerEm*fontSize;ctx.lineWidth=1;ctx.strokeStyle="black";draw.line(ctx,x,-1e4,x,1e4);draw.line(ctx,-1e4,y,1e4,y);ctx.strokeStyle="blue";draw.line(ctx,x+this.xMin*scale,-1e4,x+this.xMin*scale,1e4);draw.line(ctx,x+this.xMax*scale,-1e4,x+this.xMax*scale,1e4);draw.line(ctx,-1e4,y+-this.yMin*scale,1e4,y+-this.yMin*scale);draw.line(ctx,-1e4,y+-this.yMax*scale,1e4,y+-this.yMax*scale);ctx.strokeStyle="green";draw.line(ctx,x+this.advanceWidth*scale,-1e4,x+this.advanceWidth*scale,1e4)};exports.Glyph=Glyph},{"./check":3,"./draw":4,"./path":10}],8:[function(_dereq_,module,exports){(function(process){"use strict";var encoding=_dereq_("./encoding");var _font=_dereq_("./font");var glyph=_dereq_("./glyph");var parse=_dereq_("./parse");var path=_dereq_("./path");var cmap=_dereq_("./tables/cmap");var cff=_dereq_("./tables/cff");var glyf=_dereq_("./tables/glyf");var gpos=_dereq_("./tables/gpos");var head=_dereq_("./tables/head");var hhea=_dereq_("./tables/hhea");var hmtx=_dereq_("./tables/hmtx");var kern=_dereq_("./tables/kern");var loca=_dereq_("./tables/loca");var maxp=_dereq_("./tables/maxp");var _name=_dereq_("./tables/name");var os2=_dereq_("./tables/os2");var post=_dereq_("./tables/post");function toArrayBuffer(buffer){var i,arrayBuffer=new ArrayBuffer(buffer.length),data=new Uint8Array(arrayBuffer);for(i=0;i<buffer.length;i+=1){data[i]=buffer[i]}return arrayBuffer}function loadFromFile(path,callback){var fs=_dereq_("fs");fs.readFile(path,function(err,buffer){if(err){return callback(err.message)}callback(null,toArrayBuffer(buffer))})}function loadFromUrl(url,callback){var request=new XMLHttpRequest;request.open("get",url,true);request.responseType="arraybuffer";request.onload=function(){if(request.status!==200){return callback("Font could not be loaded: "+request.statusText)}return callback(null,request.response)};request.send()}function parseBuffer(buffer){var font,data,version,numTables,i,p,tag,offset,hmtxOffset,glyfOffset,locaOffset,cffOffset,kernOffset,gposOffset,indexToLocFormat,numGlyphs,locaTable,shortVersion;font=new _font.Font;data=new DataView(buffer,0);version=parse.getFixed(data,0);if(version===1){font.outlinesFormat="truetype"}else{version=parse.getTag(data,0);if(version==="OTTO"){font.outlinesFormat="cff"}else{throw new Error("Unsupported OpenType version "+version)}}numTables=parse.getUShort(data,4);p=12;for(i=0;i<numTables;i+=1){tag=parse.getTag(data,p);offset=parse.getULong(data,p+8);switch(tag){case"cmap":font.tables.cmap=cmap.parse(data,offset);font.encoding=new encoding.CmapEncoding(font.tables.cmap);if(!font.encoding){font.supported=false}break;case"head":font.tables.head=head.parse(data,offset);font.unitsPerEm=font.tables.head.unitsPerEm;indexToLocFormat=font.tables.head.indexToLocFormat;break;case"hhea":font.tables.hhea=hhea.parse(data,offset);font.ascender=font.tables.hhea.ascender;font.descender=font.tables.hhea.descender;font.numberOfHMetrics=font.tables.hhea.numberOfHMetrics;break;case"hmtx":hmtxOffset=offset;break;case"maxp":font.tables.maxp=maxp.parse(data,offset);font.numGlyphs=numGlyphs=font.tables.maxp.numGlyphs;break;case"name":font.tables.name=_name.parse(data,offset);font.familyName=font.tables.name.fontFamily;font.styleName=font.tables.name.fontSubfamily;break;case"OS/2":font.tables.os2=os2.parse(data,offset);break;case"post":font.tables.post=post.parse(data,offset);font.glyphNames=new encoding.GlyphNames(font.tables.post);break;case"glyf":glyfOffset=offset;break;case"loca":locaOffset=offset;break;case"CFF ":cffOffset=offset;break;case"kern":kernOffset=offset;break;case"GPOS":gposOffset=offset;break}p+=16}if(glyfOffset&&locaOffset){shortVersion=indexToLocFormat===0;locaTable=loca.parse(data,locaOffset,numGlyphs,shortVersion);font.glyphs=glyf.parse(data,glyfOffset,locaTable,font);hmtx.parse(data,hmtxOffset,font.numberOfHMetrics,font.numGlyphs,font.glyphs);encoding.addGlyphNames(font)}else if(cffOffset){cff.parse(data,cffOffset,font);encoding.addGlyphNames(font)}else{font.supported=false}if(font.supported){if(kernOffset){font.kerningPairs=kern.parse(data,kernOffset)}else{font.kerningPairs={}}if(gposOffset){gpos.parse(data,gposOffset,font)}}return font}function load(url,callback){var loader=typeof process==="undefined"||!process.browser?loadFromFile:loadFromUrl;loader(url,function(err,arrayBuffer){if(err){return callback(err)}var font=parseBuffer(arrayBuffer);if(!font.supported){return callback("Font is not supported (is this a Postscript font?)")}return callback(null,font)})}exports.Font=_font.Font;exports.Glyph=glyph.Glyph;exports.Path=path.Path;exports.parse=parseBuffer;exports.load=load}).call(this,_dereq_("FWaASH"))},{"./encoding":5,"./font":6,"./glyph":7,"./parse":9,"./path":10,"./tables/cff":12,"./tables/cmap":13,"./tables/glyf":14,"./tables/gpos":15,"./tables/head":16,"./tables/hhea":17,"./tables/hmtx":18,"./tables/kern":19,"./tables/loca":20,"./tables/maxp":21,"./tables/name":22,"./tables/os2":23,"./tables/post":24,FWaASH:2,fs:1}],9:[function(_dereq_,module,exports){"use strict";exports.getByte=function getByte(dataView,offset){return dataView.getUint8(offset)};exports.getCard8=exports.getByte;exports.getUShort=function(dataView,offset){return dataView.getUint16(offset,false)};exports.getCard16=exports.getUShort;exports.getShort=function(dataView,offset){return dataView.getInt16(offset,false)};exports.getULong=function(dataView,offset){return dataView.getUint32(offset,false)};exports.getFixed=function(dataView,offset){var decimal,fraction;decimal=dataView.getInt16(offset,false);fraction=dataView.getUint16(offset+2,false);return decimal+fraction/65535};exports.getTag=function(dataView,offset){var tag="",i;for(i=offset;i<offset+4;i+=1){tag+=String.fromCharCode(dataView.getInt8(i))}return tag};exports.getOffset=function(dataView,offset,offSize){var i,v;v=0;for(i=0;i<offSize;i+=1){v<<=8;v+=dataView.getUint8(offset+i)}return v};exports.getBytes=function(dataView,startOffset,endOffset){var bytes,i;bytes=[];for(i=startOffset;i<endOffset;i+=1){bytes.push(dataView.getUint8(i))}return bytes};exports.bytesToString=function(bytes){var s,i;s="";for(i=0;i<bytes.length;i+=1){s+=String.fromCharCode(bytes[i])}return s};var typeOffsets={"byte":1,uShort:2,"short":2,uLong:4,fixed:4,longDateTime:8,tag:4};function Parser(data,offset){this.data=data;this.offset=offset;this.relativeOffset=0}Parser.prototype.parseByte=function(){var v=this.data.getUint8(this.offset+this.relativeOffset);this.relativeOffset+=1;return v};Parser.prototype.parseChar=function(){var v=this.data.getInt8(this.offset+this.relativeOffset);this.relativeOffset+=1;return v};Parser.prototype.parseCard8=Parser.prototype.parseByte;Parser.prototype.parseUShort=function(){var v=this.data.getUint16(this.offset+this.relativeOffset);this.relativeOffset+=2;return v};Parser.prototype.parseCard16=Parser.prototype.parseUShort;Parser.prototype.parseSID=Parser.prototype.parseUShort;Parser.prototype.parseOffset16=Parser.prototype.parseUShort;Parser.prototype.parseShort=function(){var v=this.data.getInt16(this.offset+this.relativeOffset);this.relativeOffset+=2;return v};Parser.prototype.parseF2Dot14=function(){var v=this.data.getInt16(this.offset+this.relativeOffset)/16384;this.relativeOffset+=2;return v};Parser.prototype.parseULong=function(){var v=exports.getULong(this.data,this.offset+this.relativeOffset);this.relativeOffset+=4;return v};Parser.prototype.parseFixed=function(){var v=exports.getFixed(this.data,this.offset+this.relativeOffset);this.relativeOffset+=4;return v};Parser.prototype.parseOffset16List=Parser.prototype.parseUShortList=function(count){var offsets=new Array(count),dataView=this.data,offset=this.offset+this.relativeOffset;for(var i=0;i<count;i++){offsets[i]=exports.getUShort(dataView,offset);offset+=2}this.relativeOffset+=count*2;return offsets};Parser.prototype.parseString=function(length){var dataView=this.data,offset=this.offset+this.relativeOffset,string="";this.relativeOffset+=length;for(var i=0;i<length;i++){string+=String.fromCharCode(dataView.getUint8(offset+i))}return string};Parser.prototype.parseTag=function(){return this.parseString(4)};Parser.prototype.parseLongDateTime=function(){var v=exports.getULong(this.data,this.offset+this.relativeOffset+4);this.relativeOffset+=8;return v};Parser.prototype.parseFixed=function(){var v=exports.getULong(this.data,this.offset+this.relativeOffset);this.relativeOffset+=4;return v/65536};Parser.prototype.parseVersion=function(){var major=exports.getUShort(this.data,this.offset+this.relativeOffset);
var minor=exports.getUShort(this.data,this.offset+this.relativeOffset+2);this.relativeOffset+=4;return major+minor/4096/10};Parser.prototype.skip=function(type,amount){if(amount===undefined){amount=1}this.relativeOffset+=typeOffsets[type]*amount};exports.Parser=Parser},{}],10:[function(_dereq_,module,exports){"use strict";function Path(){this.commands=[];this.fill="black";this.stroke=null;this.strokeWidth=1}Path.prototype.moveTo=function(x,y){this.commands.push({type:"M",x:x,y:y})};Path.prototype.lineTo=function(x,y){this.commands.push({type:"L",x:x,y:y})};Path.prototype.curveTo=Path.prototype.bezierCurveTo=function(x1,y1,x2,y2,x,y){this.commands.push({type:"C",x1:x1,y1:y1,x2:x2,y2:y2,x:x,y:y})};Path.prototype.quadTo=Path.prototype.quadraticCurveTo=function(x1,y1,x,y){this.commands.push({type:"Q",x1:x1,y1:y1,x:x,y:y})};Path.prototype.close=Path.prototype.closePath=function(){this.commands.push({type:"Z"})};Path.prototype.extend=function(pathOrCommands){if(pathOrCommands.commands){pathOrCommands=pathOrCommands.commands}Array.prototype.push.apply(this.commands,pathOrCommands)};Path.prototype.draw=function(ctx){var i,cmd;ctx.beginPath();for(i=0;i<this.commands.length;i+=1){cmd=this.commands[i];if(cmd.type==="M"){ctx.moveTo(cmd.x,cmd.y)}else if(cmd.type==="L"){ctx.lineTo(cmd.x,cmd.y)}else if(cmd.type==="C"){ctx.bezierCurveTo(cmd.x1,cmd.y1,cmd.x2,cmd.y2,cmd.x,cmd.y)}else if(cmd.type==="Q"){ctx.quadraticCurveTo(cmd.x1,cmd.y1,cmd.x,cmd.y)}else if(cmd.type==="Z"){ctx.closePath()}}if(this.fill){ctx.fillStyle=this.fill;ctx.fill()}if(this.stroke){ctx.strokeStyle=this.stroke;ctx.lineWidth=this.strokeWidth;ctx.stroke()}};exports.Path=Path},{}],11:[function(_dereq_,module,exports){"use strict";var check=_dereq_("./check");var encode=_dereq_("./types").encode;var sizeOf=_dereq_("./types").sizeOf;function Table(tableName,fields,options){var i;for(i=0;i<fields.length;i+=1){var field=fields[i];this[field.name]=field.value}this.tableName=tableName;this.fields=fields;if(options){var optionKeys=Object.keys(options);for(i=0;i<optionKeys.length;i+=1){var k=optionKeys[i];var v=options[k];if(this[k]!==undefined){this[k]=v}}}}Table.prototype.sizeOf=function(){var v=0;for(var i=0;i<this.fields.length;i+=1){var field=this.fields[i];var value=this[field.name];if(value===undefined){value=field.value}if(typeof value.sizeOf==="function"){v+=value.sizeOf()}else{var sizeOfFunction=sizeOf[field.type];check.assert(typeof sizeOfFunction==="function","Could not find sizeOf function for field"+field.name);v+=sizeOfFunction(value)}}return v};Table.prototype.encode=function(){return encode.TABLE(this)};exports.Table=Table},{"./check":3,"./types":26}],12:[function(_dereq_,module,exports){"use strict";var encoding=_dereq_("../encoding");var _glyph=_dereq_("../glyph");var parse=_dereq_("../parse");var path=_dereq_("../path");var table=_dereq_("../table");function equals(a,b){if(a===b){return true}else if(Array.isArray(a)&&Array.isArray(b)){if(a.length!==b.length){return false}for(var i=0;i<a.length;i+=1){if(!equals(a[i],b[i])){return false}}return true}else{return false}}function parseCFFIndex(data,start,conversionFn){var offsets,objects,count,endOffset,offsetSize,objectOffset,pos,i,value;offsets=[];objects=[];count=parse.getCard16(data,start);if(count!==0){offsetSize=parse.getByte(data,start+2);objectOffset=start+(count+1)*offsetSize+2;pos=start+3;for(i=0;i<count+1;i+=1){offsets.push(parse.getOffset(data,pos,offsetSize));pos+=offsetSize}endOffset=objectOffset+offsets[count]}else{endOffset=start+2}for(i=0;i<offsets.length-1;i+=1){value=parse.getBytes(data,objectOffset+offsets[i],objectOffset+offsets[i+1]);if(conversionFn){value=conversionFn(value)}objects.push(value)}return{objects:objects,startOffset:start,endOffset:endOffset}}function parseFloatOperand(parser){var s,eof,lookup,b,n1,n2;s="";eof=15;lookup=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];while(true){b=parser.parseByte();n1=b>>4;n2=b&15;if(n1===eof){break}s+=lookup[n1];if(n2===eof){break}s+=lookup[n2]}return parseFloat(s)}function parseOperand(parser,b0){var b1,b2,b3,b4;if(b0===28){b1=parser.parseByte();b2=parser.parseByte();return b1<<8|b2}if(b0===29){b1=parser.parseByte();b2=parser.parseByte();b3=parser.parseByte();b4=parser.parseByte();return b1<<24|b2<<16|b3<<8|b4}if(b0===30){return parseFloatOperand(parser)}if(b0>=32&&b0<=246){return b0-139}if(b0>=247&&b0<=250){b1=parser.parseByte();return(b0-247)*256+b1+108}if(b0>=251&&b0<=254){b1=parser.parseByte();return-(b0-251)*256-b1-108}throw new Error("Invalid b0 "+b0)}function entriesToObject(entries){var o,key,values,i,value;o={};for(i=0;i<entries.length;i+=1){key=entries[i][0];values=entries[i][1];if(values.length===1){value=values[0]}else{value=values}if(o.hasOwnProperty(key)){throw new Error("Object "+o+" already has key "+key)}o[key]=value}return o}function parseCFFDict(data,start,size){var parser,entries,operands,op;start=start!==undefined?start:0;parser=new parse.Parser(data,start);entries=[];operands=[];size=size!==undefined?size:data.length;while(parser.relativeOffset<size){op=parser.parseByte();if(op<=21){if(op===12){op=1200+parser.parseByte()}entries.push([op,operands]);operands=[]}else{operands.push(parseOperand(parser,op))}}return entriesToObject(entries)}function getCFFString(strings,index){if(index<=390){index=encoding.cffStandardStrings[index]}else{index=strings[index-391]}return index}function interpretDict(dict,meta,strings){var i,m,value,newDict;newDict={};for(i=0;i<meta.length;i+=1){m=meta[i];value=dict[m.op];if(value===undefined){value=m.value!==undefined?m.value:null}if(m.type==="SID"){value=getCFFString(strings,value)}newDict[m.name]=value}return newDict}function parseCFFHeader(data,start){var header={};header.formatMajor=parse.getCard8(data,start);header.formatMinor=parse.getCard8(data,start+1);header.size=parse.getCard8(data,start+2);header.offsetSize=parse.getCard8(data,start+3);header.startOffset=start;header.endOffset=start+4;return header}var TOP_DICT_META=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]}];var PRIVATE_DICT_META=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function parseCFFTopDict(data,strings){var dict;dict=parseCFFDict(data,0,data.byteLength);return interpretDict(dict,TOP_DICT_META,strings)}function parseCFFPrivateDict(data,start,size,strings){var dict;dict=parseCFFDict(data,start,size);return interpretDict(dict,PRIVATE_DICT_META,strings)}function parseCFFCharset(data,start,nGlyphs,strings){var parser,format,charset,i,sid,count;parser=new parse.Parser(data,start);nGlyphs-=1;charset=[".notdef"];format=parser.parseCard8();if(format===0){for(i=0;i<nGlyphs;i+=1){sid=parser.parseSID();charset.push(getCFFString(strings,sid))}}else if(format===1){while(charset.length<=nGlyphs){sid=parser.parseSID();count=parser.parseCard8();for(i=0;i<=count;i+=1){charset.push(getCFFString(strings,sid));sid+=1}}}else if(format===2){while(charset.length<=nGlyphs){sid=parser.parseSID();count=parser.parseCard16();for(i=0;i<=count;i+=1){charset.push(getCFFString(strings,sid));sid+=1}}}else{throw new Error("Unknown charset format "+format)}return charset}function parseCFFEncoding(data,start,charset){var enc,parser,format,nCodes,i,code,nRanges,first,nLeft,j;enc={};parser=new parse.Parser(data,start);format=parser.parseCard8();if(format===0){nCodes=parser.parseCard8();for(i=0;i<nCodes;i+=1){code=parser.parseCard8();enc[code]=i}}else if(format===1){nRanges=parser.parseCard8();code=1;for(i=0;i<nRanges;i+=1){first=parser.parseCard8();nLeft=parser.parseCard8();for(j=first;j<=first+nLeft;j+=1){enc[j]=code;code+=1}}}else{throw new Error("Unknown encoding format "+format)}return new encoding.CffEncoding(enc,charset)}function parseCFFCharstring(code,font,index){var p,glyph,stack,nStems,haveWidth,width,x,y,c1x,c1y,c2x,c2y,v;p=new path.Path;stack=[];nStems=0;haveWidth=false;width=font.defaultWidthX;x=y=0;function parseStems(){var hasWidthArg;hasWidthArg=stack.length%2!==0;if(hasWidthArg&&!haveWidth){width=stack.shift()+font.nominalWidthX}nStems+=stack.length>>1;stack.length=0;haveWidth=true}function parse(code){var i,b1,b2,b3,b4,codeIndex,subrCode;i=0;while(i<code.length){v=code[i];i+=1;switch(v){case 1:parseStems();break;case 3:parseStems();break;case 4:if(stack.length>1&&!haveWidth){width=stack.shift()+font.nominalWidthX;haveWidth=true}y+=stack.pop();p.moveTo(x,y);break;case 5:while(stack.length>0){x+=stack.shift();y+=stack.shift();p.lineTo(x,y)}break;case 6:while(stack.length>0){x+=stack.shift();p.lineTo(x,y);if(stack.length===0){break}y+=stack.shift();p.lineTo(x,y)}break;case 7:while(stack.length>0){y+=stack.shift();p.lineTo(x,y);if(stack.length===0){break}x+=stack.shift();p.lineTo(x,y)}break;case 8:while(stack.length>0){c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,x,y)}break;case 10:codeIndex=stack.pop()+font.subrsBias;subrCode=font.subrs[codeIndex];if(subrCode){parse(subrCode)}break;case 11:return;case 12:v=code[i];i+=1;break;case 14:if(stack.length>0&&!haveWidth){width=stack.shift()+font.nominalWidthX;haveWidth=true}p.closePath();break;case 18:parseStems();break;case 19:case 20:parseStems();i+=nStems+7>>3;break;case 21:if(stack.length>2&&!haveWidth){width=stack.shift()+font.nominalWidthX;haveWidth=true}y+=stack.pop();x+=stack.pop();p.moveTo(x,y);break;case 22:if(stack.length>1&&!haveWidth){width=stack.shift()+font.nominalWidthX;haveWidth=true}x+=stack.pop();p.moveTo(x,y);break;case 23:parseStems();break;case 24:while(stack.length>2){c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,x,y)}x+=stack.shift();y+=stack.shift();p.lineTo(x,y);break;case 25:while(stack.length>6){x+=stack.shift();y+=stack.shift();p.lineTo(x,y)}c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,x,y);break;case 26:if(stack.length%2){x+=stack.shift()}while(stack.length>0){c1x=x;c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x;y=c2y+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,x,y)}break;case 27:if(stack.length%2){y+=stack.shift()}while(stack.length>0){c1x=x+stack.shift();c1y=y;c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y;p.curveTo(c1x,c1y,c2x,c2y,x,y)}break;case 28:b1=code[i];b2=code[i+1];stack.push((b1<<24|b2<<16)>>16);i+=2;break;case 29:codeIndex=stack.pop()+font.gsubrsBias;subrCode=font.gsubrs[codeIndex];if(subrCode){parse(subrCode)}break;case 30:while(stack.length>0){c1x=x;c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y+(stack.length===1?stack.shift():0);p.curveTo(c1x,c1y,c2x,c2y,x,y);if(stack.length===0){break}c1x=x+stack.shift();c1y=y;c2x=c1x+stack.shift();c2y=c1y+stack.shift();y=c2y+stack.shift();x=c2x+(stack.length===1?stack.shift():0);p.curveTo(c1x,c1y,c2x,c2y,x,y)}break;case 31:while(stack.length>0){c1x=x+stack.shift();c1y=y;c2x=c1x+stack.shift();c2y=c1y+stack.shift();y=c2y+stack.shift();x=c2x+(stack.length===1?stack.shift():0);p.curveTo(c1x,c1y,c2x,c2y,x,y);if(stack.length===0){break}c1x=x;c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y+(stack.length===1?stack.shift():0);p.curveTo(c1x,c1y,c2x,c2y,x,y)}break;default:if(v<32){console.log("Glyph "+index+": unknown operator "+v)}else if(v<247){stack.push(v-139)}else if(v<251){b1=code[i];i+=1;stack.push((v-247)*256+b1+108)}else if(v<255){b1=code[i];i+=1;stack.push(-(v-251)*256-b1-108)}else{b1=code[i];b2=code[i+1];b3=code[i+2];b4=code[i+3];i+=4;stack.push((b1<<24|b2<<16|b3<<8|b4)/65536)}}}}parse(code);glyph=new _glyph.Glyph({font:font,index:index});glyph.path=p;glyph.advanceWidth=width;return glyph}function calcCFFSubroutineBias(subrs){var bias;if(subrs.length<1240){bias=107}else if(subrs.length<33900){bias=1131}else{bias=32768}return bias}function parseCFFTable(data,start,font){var header,nameIndex,topDictIndex,stringIndex,globalSubrIndex,topDict,privateDictOffset,privateDict,subrOffset,subrIndex,charString,charStringsIndex,charset,i;font.tables.cff={};header=parseCFFHeader(data,start);nameIndex=parseCFFIndex(data,header.endOffset,parse.bytesToString);topDictIndex=parseCFFIndex(data,nameIndex.endOffset);stringIndex=parseCFFIndex(data,topDictIndex.endOffset,parse.bytesToString);globalSubrIndex=parseCFFIndex(data,stringIndex.endOffset);font.gsubrs=globalSubrIndex.objects;font.gsubrsBias=calcCFFSubroutineBias(font.gsubrs);var topDictData=new DataView(new Uint8Array(topDictIndex.objects[0]).buffer);topDict=parseCFFTopDict(topDictData,stringIndex.objects);font.tables.cff.topDict=topDict;privateDictOffset=start+topDict["private"][1];privateDict=parseCFFPrivateDict(data,privateDictOffset,topDict["private"][0],stringIndex.objects);font.defaultWidthX=privateDict.defaultWidthX;font.nominalWidthX=privateDict.nominalWidthX;if(privateDict.subrs!==0){subrOffset=privateDictOffset+privateDict.subrs;subrIndex=parseCFFIndex(data,subrOffset);font.subrs=subrIndex.objects;font.subrsBias=calcCFFSubroutineBias(font.subrs)}else{font.subrs=[];font.subrsBias=0}charStringsIndex=parseCFFIndex(data,start+topDict.charStrings);font.nGlyphs=charStringsIndex.objects.length;charset=parseCFFCharset(data,start+topDict.charset,font.nGlyphs,stringIndex.objects);if(topDict.encoding===0){font.cffEncoding=new encoding.CffEncoding(encoding.cffStandardEncoding,charset)}else if(topDict.encoding===1){font.cffEncoding=new encoding.CffEncoding(encoding.cffExpertEncoding,charset)}else{font.cffEncoding=parseCFFEncoding(data,start+topDict.encoding,charset)}font.encoding=font.encoding||font.cffEncoding;font.glyphs=[];for(i=0;i<font.nGlyphs;i+=1){charString=charStringsIndex.objects[i];font.glyphs.push(parseCFFCharstring(charString,font,i))}}function encodeString(s,strings){var i,sid;i=encoding.cffStandardStrings.indexOf(s);if(i>=0){sid=i}i=strings.indexOf(s);if(i>=0){sid=i+encoding.cffStandardStrings.length}else{sid=encoding.cffStandardStrings.length+strings.length;strings.push(s)}return sid}function makeHeader(){return new table.Table("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function makeNameIndex(fontNames){var t=new table.Table("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);t.names=[];for(var i=0;i<fontNames.length;i+=1){t.names.push({name:"name_"+i,type:"NAME",value:fontNames[i]})}return t}function makeDict(meta,attrs,strings){var m={},i,entry,value;for(i=0;i<meta.length;i+=1){entry=meta[i];value=attrs[entry.name];if(value!==undefined&&!equals(value,entry.value)){if(entry.type==="SID"){value=encodeString(value,strings)}m[entry.op]={name:entry.name,type:entry.type,value:value}}}return m}function makeTopDict(attrs,strings){var t=new table.Table("Top DICT",[{name:"dict",type:"DICT",value:{}}]);t.dict=makeDict(TOP_DICT_META,attrs,strings);return t}function makeTopDictIndex(topDict){var t=new table.Table("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);t.topDicts=[{name:"topDict_0",type:"TABLE",value:topDict}];return t}function makeStringIndex(strings){var t=new table.Table("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);t.strings=[];for(var i=0;i<strings.length;i+=1){t.strings.push({name:"string_"+i,type:"STRING",value:strings[i]})}return t}function makeGlobalSubrIndex(){return new table.Table("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function makeCharsets(glyphNames,strings){var t=new table.Table("Charsets",[{name:"format",type:"Card8",value:0}]);for(var i=0;i<glyphNames.length;i+=1){var glyphName=glyphNames[i];var glyphSID=encodeString(glyphName,strings);t.fields.push({name:"glyph_"+i,type:"SID",value:glyphSID})}return t}function glyphToOps(glyph){var ops=[],path=glyph.path,x,y,i,cmd,dx,dy,dx1,dy1,dx2,dy2;ops.push({name:"width",type:"NUMBER",value:glyph.advanceWidth});x=0;y=0;for(i=0;i<path.commands.length;i+=1){cmd=path.commands[i];if(cmd.type==="M"){dx=cmd.x-x;dy=cmd.y-y;ops.push({name:"dx",type:"NUMBER",value:dx});ops.push({name:"dy",type:"NUMBER",value:dy});ops.push({name:"rmoveto",type:"OP",value:21});x=cmd.x;y=cmd.y}else if(cmd.type==="L"){dx=cmd.x-x;dy=cmd.y-y;ops.push({name:"dx",type:"NUMBER",value:dx});ops.push({name:"dy",type:"NUMBER",value:dy});ops.push({name:"rlineto",type:"OP",value:5});x=cmd.x;y=cmd.y}else if(cmd.type==="Q"){throw new Error("Writing quad curves is currently not supported.")}else if(cmd.type==="C"){dx1=cmd.x1-x;dy1=cmd.y1-y;dx2=cmd.x2-cmd.x1;dy2=cmd.y2-cmd.y1;dx=cmd.x-cmd.x2;dy=cmd.y-cmd.y2;ops.push({name:"dx1",type:"NUMBER",value:dx1});ops.push({name:"dy1",type:"NUMBER",value:dy1});ops.push({name:"dx2",type:"NUMBER",value:dx2});ops.push({name:"dy2",type:"NUMBER",value:dy2});ops.push({name:"dx",type:"NUMBER",value:dx});ops.push({name:"dy",type:"NUMBER",value:dy});ops.push({name:"rrcurveto",type:"OP",value:8});x=cmd.x;y=cmd.y}else if(cmd.type==="Z"){}}ops.push({name:"endchar",type:"OP",value:14});return ops}function makeCharStringsIndex(glyphs){var t=new table.Table("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]);for(var i=0;i<glyphs.length;i+=1){var glyph=glyphs[i];var ops=glyphToOps(glyph);t.charStrings.push({name:glyph.name,type:"CHARSTRING",value:ops})}return t}function makePrivateDict(attrs,strings){var t=new table.Table("Private DICT",[{name:"dict",type:"DICT",value:{}}]);t.dict=makeDict(PRIVATE_DICT_META,attrs,strings);return t}function makePrivateDictIndex(privateDict){var t=new table.Table("Private DICT INDEX",[{name:"privateDicts",type:"INDEX",value:[]}]);t.privateDicts=[{name:"privateDict_0",type:"TABLE",value:privateDict}];return t}function makeCFFTable(glyphs,options){var t=new table.Table("CFF ",[{name:"header",type:"TABLE"},{name:"nameIndex",type:"TABLE"},{name:"topDictIndex",type:"TABLE"},{name:"stringIndex",type:"TABLE"},{name:"globalSubrIndex",type:"TABLE"},{name:"charsets",type:"TABLE"},{name:"charStringsIndex",type:"TABLE"},{name:"privateDictIndex",type:"TABLE"}]);var attrs={version:options.version,fullName:options.fullName,familyName:options.familyName,weight:options.weightName,charset:999,encoding:0,charStrings:999,"private":[0,999]};var privateAttrs={};var glyphNames=[];for(var i=1;i<glyphs.length;i+=1){glyphNames.push(glyphs[i].name)}var strings=[];t.header=makeHeader();t.nameIndex=makeNameIndex([options.postScriptName]);var topDict=makeTopDict(attrs,strings);t.topDictIndex=makeTopDictIndex(topDict);t.globalSubrIndex=makeGlobalSubrIndex();t.charsets=makeCharsets(glyphNames,strings);t.charStringsIndex=makeCharStringsIndex(glyphs);var privateDict=makePrivateDict(privateAttrs,strings);t.privateDictIndex=makePrivateDictIndex(privateDict);t.stringIndex=makeStringIndex(strings);var startOffset=t.header.sizeOf()+t.nameIndex.sizeOf()+t.topDictIndex.sizeOf()+t.stringIndex.sizeOf()+t.globalSubrIndex.sizeOf();attrs.charset=startOffset;attrs.encoding=0;attrs.charStrings=attrs.charset+t.charsets.sizeOf();attrs.private[1]=attrs.charStrings+t.charStringsIndex.sizeOf();topDict=makeTopDict(attrs,strings);t.topDictIndex=makeTopDictIndex(topDict);return t}exports.parse=parseCFFTable;exports.make=makeCFFTable},{"../encoding":5,"../glyph":7,"../parse":9,"../path":10,"../table":11}],13:[function(_dereq_,module,exports){"use strict";var check=_dereq_("../check");var parse=_dereq_("../parse");var table=_dereq_("../table");function parseCmapTable(data,start){var version,numTables,offset,platformId,encodingId,format,segCount,endCountParser,startCountParser,idDeltaParser,idRangeOffsetParser,glyphIndexOffset,endCount,startCount,i,c,idDelta,idRangeOffset,p,glyphIndex;var cmap={};cmap.version=version=parse.getUShort(data,start);check.argument(version===0,"cmap table version should be 0.");cmap.numtables=numTables=parse.getUShort(data,start+2);offset=-1;for(i=0;i<numTables;i+=1){platformId=parse.getUShort(data,start+4+i*8);encodingId=parse.getUShort(data,start+4+i*8+2);if(platformId===3&&(encodingId===1||encodingId===0)){offset=parse.getULong(data,start+4+i*8+4);break}}if(offset===-1){return null}p=new parse.Parser(data,start+offset);cmap.format=format=p.parseUShort();check.argument(format===4,"Only format 4 cmap tables are supported.");cmap.length=p.parseUShort();cmap.language=p.parseUShort();cmap.segCount=segCount=p.parseUShort()>>1;p.skip("uShort",3);cmap.glyphIndexMap={};endCountParser=new parse.Parser(data,start+offset+14);startCountParser=new parse.Parser(data,start+offset+16+segCount*2);idDeltaParser=new parse.Parser(data,start+offset+16+segCount*4);idRangeOffsetParser=new parse.Parser(data,start+offset+16+segCount*6);glyphIndexOffset=start+offset+16+segCount*8;for(i=0;i<segCount-1;i+=1){endCount=endCountParser.parseUShort();startCount=startCountParser.parseUShort();idDelta=idDeltaParser.parseShort();idRangeOffset=idRangeOffsetParser.parseUShort();for(c=startCount;c<=endCount;c+=1){if(idRangeOffset!==0){glyphIndexOffset=idRangeOffsetParser.offset+idRangeOffsetParser.relativeOffset-2;glyphIndexOffset+=idRangeOffset;glyphIndexOffset+=(c-startCount)*2;glyphIndex=parse.getUShort(data,glyphIndexOffset);if(glyphIndex!==0){glyphIndex=glyphIndex+idDelta&65535}}else{glyphIndex=c+idDelta&65535}cmap.glyphIndexMap[c]=glyphIndex}}return cmap}function addSegment(t,code,glyphIndex){t.segments.push({end:code,start:code,delta:-(code-glyphIndex),offset:0})}function addTerminatorSegment(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function makeCmapTable(glyphs){var i,j,glyph;var t=new table.Table("cmap",[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:1},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:12},{name:"format",type:"USHORT",value:4},{name:"length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);t.segments=[];for(i=0;i<glyphs.length;i+=1){glyph=glyphs[i];for(j=0;j<glyph.unicodes.length;j+=1){addSegment(t,glyph.unicodes[j],i)}}addTerminatorSegment(t);var segCount;segCount=t.segments.length;t.segCountX2=segCount*2;t.searchRange=Math.pow(2,Math.floor(Math.log(segCount)/Math.log(2)))*2;t.entrySelector=Math.log(t.searchRange/2)/Math.log(2);t.rangeShift=t.segCountX2-t.searchRange;var endCounts=[],startCounts=[],idDeltas=[],idRangeOffsets=[],glyphIds=[];for(i=0;i<segCount;i+=1){var segment=t.segments[i];endCounts=endCounts.concat({name:"end_"+i,type:"USHORT",value:segment.end});startCounts=startCounts.concat({name:"start_"+i,type:"USHORT",value:segment.start});idDeltas=idDeltas.concat({name:"idDelta_"+i,type:"SHORT",value:segment.delta});idRangeOffsets=idRangeOffsets.concat({name:"idRangeOffset_"+i,type:"USHORT",value:segment.offset});if(segment.glyphId!==undefined){glyphIds=glyphIds.concat({name:"glyph_"+i,type:"USHORT",value:segment.glyphId})}}t.fields=t.fields.concat(endCounts);t.fields.push({name:"reservedPad",type:"USHORT",value:0});t.fields=t.fields.concat(startCounts);t.fields=t.fields.concat(idDeltas);t.fields=t.fields.concat(idRangeOffsets);t.fields=t.fields.concat(glyphIds);t.length=14+endCounts.length*2+2+startCounts.length*2+idDeltas.length*2+idRangeOffsets.length*2+glyphIds.length*2;return t}exports.parse=parseCmapTable;exports.make=makeCmapTable},{"../check":3,"../parse":9,"../table":11}],14:[function(_dereq_,module,exports){"use strict";var check=_dereq_("../check");var _glyph=_dereq_("../glyph");var parse=_dereq_("../parse");var path=_dereq_("../path");function parseGlyphCoordinate(p,flag,previousValue,shortVectorBitMask,sameBitMask){var v;if((flag&shortVectorBitMask)>0){v=p.parseByte();if((flag&sameBitMask)===0){v=-v}v=previousValue+v}else{if((flag&sameBitMask)>0){v=previousValue}else{v=previousValue+p.parseShort()}}return v}function parseGlyph(data,start,index,font){var p,glyph,flag,i,j,flags,endPointIndices,numberOfCoordinates,repeatCount,points,point,px,py,component,moreComponents;p=new parse.Parser(data,start);glyph=new _glyph.Glyph({font:font,index:index});glyph.numberOfContours=p.parseShort();glyph.xMin=p.parseShort();glyph.yMin=p.parseShort();glyph.xMax=p.parseShort();glyph.yMax=p.parseShort();if(glyph.numberOfContours>0){endPointIndices=glyph.endPointIndices=[];for(i=0;i<glyph.numberOfContours;i+=1){endPointIndices.push(p.parseUShort())}glyph.instructionLength=p.parseUShort();glyph.instructions=[];for(i=0;i<glyph.instructionLength;i+=1){glyph.instructions.push(p.parseByte())}numberOfCoordinates=endPointIndices[endPointIndices.length-1]+1;flags=[];for(i=0;i<numberOfCoordinates;i+=1){flag=p.parseByte();flags.push(flag);if((flag&8)>0){repeatCount=p.parseByte();for(j=0;j<repeatCount;j+=1){flags.push(flag);i+=1}}}check.argument(flags.length===numberOfCoordinates,"Bad flags.");if(endPointIndices.length>0){points=[];if(numberOfCoordinates>0){for(i=0;i<numberOfCoordinates;i+=1){flag=flags[i];point={};point.onCurve=!!(flag&1);point.lastPointOfContour=endPointIndices.indexOf(i)>=0;points.push(point)}px=0;for(i=0;i<numberOfCoordinates;i+=1){flag=flags[i];point=points[i];point.x=parseGlyphCoordinate(p,flag,px,2,16);px=point.x}py=0;for(i=0;i<numberOfCoordinates;i+=1){flag=flags[i];point=points[i];point.y=parseGlyphCoordinate(p,flag,py,4,32);py=point.y}}glyph.points=points}else{glyph.points=[]}}else if(glyph.numberOfContours===0){glyph.points=[]}else{glyph.isComposite=true;glyph.points=[];glyph.components=[];moreComponents=true;while(moreComponents){flags=p.parseUShort();component={glyphIndex:p.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};if((flags&1)>0){component.dx=p.parseShort();component.dy=p.parseShort()}else{component.dx=p.parseChar();component.dy=p.parseChar()}if((flags&8)>0){component.xScale=component.yScale=p.parseF2Dot14()}else if((flags&64)>0){component.xScale=p.parseF2Dot14();component.yScale=p.parseF2Dot14()}else if((flags&128)>0){component.xScale=p.parseF2Dot14();component.scale01=p.parseF2Dot14();component.scale10=p.parseF2Dot14();component.yScale=p.parseF2Dot14()}glyph.components.push(component);moreComponents=!!(flags&32)}}return glyph}function transformPoints(points,transform){var newPoints,i,pt,newPt;newPoints=[];for(i=0;i<points.length;i+=1){pt=points[i];newPt={x:transform.xScale*pt.x+transform.scale01*pt.y+transform.dx,y:transform.scale10*pt.x+transform.yScale*pt.y+transform.dy,onCurve:pt.onCurve,lastPointOfContour:pt.lastPointOfContour};newPoints.push(newPt)}return newPoints}function getContours(points){var contours,currentContour,i,pt;contours=[];currentContour=[];for(i=0;i<points.length;i+=1){pt=points[i];currentContour.push(pt);if(pt.lastPointOfContour){contours.push(currentContour);currentContour=[]}}check.argument(currentContour.length===0,"There are still points left in the current contour.");return contours}function getPath(points){var p,contours,i,realFirstPoint,j,contour,pt,firstPt,prevPt,midPt,curvePt,lastPt;p=new path.Path;if(!points){return p}contours=getContours(points);for(i=0;i<contours.length;i+=1){contour=contours[i];firstPt=contour[0];lastPt=contour[contour.length-1];if(firstPt.onCurve){curvePt=null;realFirstPoint=true}else{if(lastPt.onCurve){firstPt=lastPt}else{firstPt={x:(firstPt.x+lastPt.x)/2,y:(firstPt.y+lastPt.y)/2}}curvePt=firstPt;realFirstPoint=false}p.moveTo(firstPt.x,firstPt.y);for(j=realFirstPoint?1:0;j<contour.length;j+=1){pt=contour[j];prevPt=j===0?firstPt:contour[j-1];if(prevPt.onCurve&&pt.onCurve){p.lineTo(pt.x,pt.y)}else if(prevPt.onCurve&&!pt.onCurve){curvePt=pt}else if(!prevPt.onCurve&&!pt.onCurve){midPt={x:(prevPt.x+pt.x)/2,y:(prevPt.y+pt.y)/2};p.quadraticCurveTo(prevPt.x,prevPt.y,midPt.x,midPt.y);curvePt=pt}else if(!prevPt.onCurve&&pt.onCurve){p.quadraticCurveTo(curvePt.x,curvePt.y,pt.x,pt.y);curvePt=null}else{throw new Error("Invalid state.")}}if(firstPt!==lastPt){if(curvePt){p.quadraticCurveTo(curvePt.x,curvePt.y,firstPt.x,firstPt.y)}else{p.lineTo(firstPt.x,firstPt.y)}}}p.closePath();return p}function parseGlyfTable(data,start,loca,font){var glyphs,i,j,offset,nextOffset,glyph,component,componentGlyph,transformedPoints;glyphs=[];for(i=0;i<loca.length-1;i+=1){offset=loca[i];nextOffset=loca[i+1];if(offset!==nextOffset){glyphs.push(parseGlyph(data,start+offset,i,font))}else{glyphs.push(new _glyph.Glyph({font:font,index:i}))}}for(i=0;i<glyphs.length;i+=1){glyph=glyphs[i];if(glyph.isComposite){for(j=0;j<glyph.components.length;j+=1){component=glyph.components[j];componentGlyph=glyphs[component.glyphIndex];if(componentGlyph.points){transformedPoints=transformPoints(componentGlyph.points,component);glyph.points=glyph.points.concat(transformedPoints)}}}glyph.path=getPath(glyph.points)}return glyphs}exports.parse=parseGlyfTable},{"../check":3,"../glyph":7,"../parse":9,"../path":10}],15:[function(_dereq_,module,exports){"use strict";var check=_dereq_("../check");var parse=_dereq_("../parse");function parseTaggedListTable(data,start){var p=new parse.Parser(data,start),n=p.parseUShort(),list=[];for(var i=0;i<n;i++){list[p.parseTag()]={offset:p.parseUShort()}}return list}function parseCoverageTable(data,start){var p=new parse.Parser(data,start),format=p.parseUShort(),count=p.parseUShort();if(format===1){return p.parseUShortList(count)}else if(format===2){var i,begin,end,index,coverage=[];for(;count--;){begin=p.parseUShort();end=p.parseUShort();index=p.parseUShort();for(i=begin;i<=end;i++){coverage[index++]=i}}return coverage}}function parseClassDefTable(data,start){var p=new parse.Parser(data,start),format=p.parseUShort();if(format===1){var startGlyph=p.parseUShort(),glyphCount=p.parseUShort(),classes=p.parseUShortList(glyphCount);return function(glyphID){return classes[glyphID-startGlyph]||0}}else if(format===2){var rangeCount=p.parseUShort(),startGlyphs=[],endGlyphs=[],classValues=[];for(var i=0;i<rangeCount;i++){startGlyphs[i]=p.parseUShort();endGlyphs[i]=p.parseUShort();classValues[i]=p.parseUShort()}return function(glyphID){var l,c,r;l=0;r=startGlyphs.length-1;while(l<r){c=l+r+1>>1;if(glyphID<startGlyphs[c]){r=c-1}else{l=c}}if(startGlyphs[l]<=glyphID&&glyphID<=endGlyphs[l]){return classValues[l]||0}return 0}}}function parsePairPosSubTable(data,start){var p=new parse.Parser(data,start);var format,coverageOffset,coverage,valueFormat1,valueFormat2,sharedPairSets,firstGlyph,secondGlyph,value1,value2;format=p.parseUShort();coverageOffset=p.parseUShort();coverage=parseCoverageTable(data,start+coverageOffset);valueFormat1=p.parseUShort();valueFormat2=p.parseUShort();if(valueFormat1!==4||valueFormat2!==0)return;sharedPairSets={};if(format===1){var pairSetCount,pairSetOffsets,pairSetOffset,sharedPairSet,pairValueCount,pairSet;pairSetCount=p.parseUShort();pairSet=[];pairSetOffsets=p.parseOffset16List(pairSetCount);for(firstGlyph=0;firstGlyph<pairSetCount;firstGlyph++){pairSetOffset=pairSetOffsets[firstGlyph];sharedPairSet=sharedPairSets[pairSetOffset];if(!sharedPairSet){sharedPairSet={};
p.relativeOffset=pairSetOffset;pairValueCount=p.parseUShort();for(;pairValueCount--;){secondGlyph=p.parseUShort();if(valueFormat1)value1=p.parseShort();if(valueFormat2)value2=p.parseShort();sharedPairSet[secondGlyph]=value1}}pairSet[coverage[firstGlyph]]=sharedPairSet}return function(leftGlyph,rightGlyph){var pairs=pairSet[leftGlyph];if(pairs)return pairs[rightGlyph]}}else if(format===2){var classDef1Offset,classDef2Offset,class1Count,class2Count,i,j,getClass1,getClass2,kerningMatrix,kerningRow,covered;classDef1Offset=p.parseUShort();classDef2Offset=p.parseUShort();class1Count=p.parseUShort();class2Count=p.parseUShort();getClass1=parseClassDefTable(data,start+classDef1Offset);getClass2=parseClassDefTable(data,start+classDef2Offset);kerningMatrix=[];for(i=0;i<class1Count;i++){kerningRow=kerningMatrix[i]=[];for(j=0;j<class2Count;j++){if(valueFormat1)value1=p.parseShort();if(valueFormat2)value2=p.parseShort();kerningRow[j]=value1}}covered={};for(i=0;i<coverage.length;i++)covered[coverage[i]]=1;return function(leftGlyph,rightGlyph){if(!covered[leftGlyph])return null;var class1=getClass1(leftGlyph),class2=getClass2(rightGlyph),kerningRow=kerningMatrix[class1];return kerningRow?kerningRow[class2]:null}}}function parseLookupTable(data,start){var p=new parse.Parser(data,start);var table,lookupType,lookupFlag,useMarkFilteringSet,subTableCount,subTableOffsets,subtables,i;lookupType=p.parseUShort();lookupFlag=p.parseUShort();useMarkFilteringSet=lookupFlag&16;subTableCount=p.parseUShort();subTableOffsets=p.parseOffset16List(subTableCount);table={lookupType:lookupType,lookupFlag:lookupFlag,markFilteringSet:useMarkFilteringSet?p.parseUShort():-1};if(lookupType===2){subtables=[];for(i=0;i<subTableCount;i++){subtables.push(parsePairPosSubTable(data,start+subTableOffsets[i]))}table.getKerningValue=function(leftGlyph,rightGlyph){for(var i=subtables.length;i--;){var value=subtables[i](leftGlyph,rightGlyph);if(value!==undefined)return value}return 0}}return table}function parseGposTable(data,start,font){var p,tableVersion,lookupListOffset,scriptList,i,featureList,lookupCount,lookupTableOffsets,lookupListAbsoluteOffset,table;p=new parse.Parser(data,start);tableVersion=p.parseFixed();check.argument(tableVersion===1,"Unsupported GPOS table version.");scriptList=parseTaggedListTable(data,start+p.parseUShort());featureList=parseTaggedListTable(data,start+p.parseUShort());lookupListOffset=p.parseUShort();p.relativeOffset=lookupListOffset;lookupCount=p.parseUShort();lookupTableOffsets=p.parseOffset16List(lookupCount);lookupListAbsoluteOffset=start+lookupListOffset;for(i=0;i<lookupCount;i++){table=parseLookupTable(data,lookupListAbsoluteOffset+lookupTableOffsets[i]);if(table.lookupType===2&&!font.getGposKerningValue)font.getGposKerningValue=table.getKerningValue}}exports.parse=parseGposTable},{"../check":3,"../parse":9}],16:[function(_dereq_,module,exports){"use strict";var check=_dereq_("../check");var parse=_dereq_("../parse");var table=_dereq_("../table");function parseHeadTable(data,start){var head={},p=new parse.Parser(data,start);head.version=p.parseVersion();head.fontRevision=Math.round(p.parseFixed()*1e3)/1e3;head.checkSumAdjustment=p.parseULong();head.magicNumber=p.parseULong();check.argument(head.magicNumber===1594834165,"Font header has wrong magic number.");head.flags=p.parseUShort();head.unitsPerEm=p.parseUShort();head.created=p.parseLongDateTime();head.modified=p.parseLongDateTime();head.xMin=p.parseShort();head.yMin=p.parseShort();head.xMax=p.parseShort();head.yMax=p.parseShort();head.macStyle=p.parseUShort();head.lowestRecPPEM=p.parseUShort();head.fontDirectionHint=p.parseShort();head.indexToLocFormat=p.parseShort();head.glyphDataFormat=p.parseShort();return head}function makeHeadTable(options){return new table.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:0},{name:"modified",type:"LONGDATETIME",value:0},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],options)}exports.parse=parseHeadTable;exports.make=makeHeadTable},{"../check":3,"../parse":9,"../table":11}],17:[function(_dereq_,module,exports){"use strict";var parse=_dereq_("../parse");var table=_dereq_("../table");function parseHheaTable(data,start){var hhea={},p=new parse.Parser(data,start);hhea.version=p.parseVersion();hhea.ascender=p.parseShort();hhea.descender=p.parseShort();hhea.lineGap=p.parseShort();hhea.advanceWidthMax=p.parseUShort();hhea.minLeftSideBearing=p.parseShort();hhea.minRightSideBearing=p.parseShort();hhea.xMaxExtent=p.parseShort();hhea.caretSlopeRise=p.parseShort();hhea.caretSlopeRun=p.parseShort();hhea.caretOffset=p.parseShort();p.relativeOffset+=8;hhea.metricDataFormat=p.parseShort();hhea.numberOfHMetrics=p.parseUShort();return hhea}function makeHheaTable(options){return new table.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],options)}exports.parse=parseHheaTable;exports.make=makeHheaTable},{"../parse":9,"../table":11}],18:[function(_dereq_,module,exports){"use strict";var parse=_dereq_("../parse");var table=_dereq_("../table");function parseHmtxTable(data,start,numMetrics,numGlyphs,glyphs){var p,i,glyph,advanceWidth,leftSideBearing;p=new parse.Parser(data,start);for(i=0;i<numGlyphs;i+=1){if(i<numMetrics){advanceWidth=p.parseUShort();leftSideBearing=p.parseShort()}glyph=glyphs[i];glyph.advanceWidth=advanceWidth;glyph.leftSideBearing=leftSideBearing}}function makeHmtxTable(glyphs){var t=new table.Table("hmtx",[]);for(var i=0;i<glyphs.length;i+=1){var glyph=glyphs[i];var advanceWidth=glyph.advanceWidth||0;var leftSideBearing=glyph.leftSideBearing||0;t.fields.push({name:"advanceWidth_"+i,type:"USHORT",value:advanceWidth});t.fields.push({name:"leftSideBearing_"+i,type:"SHORT",value:leftSideBearing})}return t}exports.parse=parseHmtxTable;exports.make=makeHmtxTable},{"../parse":9,"../table":11}],19:[function(_dereq_,module,exports){"use strict";var check=_dereq_("../check");var parse=_dereq_("../parse");function parseKernTable(data,start){var pairs,p,tableVersion,subTableVersion,nPairs,i,leftIndex,rightIndex,value;pairs={};p=new parse.Parser(data,start);tableVersion=p.parseUShort();check.argument(tableVersion===0,"Unsupported kern table version.");p.skip("uShort",1);subTableVersion=p.parseUShort();check.argument(subTableVersion===0,"Unsupported kern sub-table version.");p.skip("uShort",2);nPairs=p.parseUShort();p.skip("uShort",3);for(i=0;i<nPairs;i+=1){leftIndex=p.parseUShort();rightIndex=p.parseUShort();value=p.parseShort();pairs[leftIndex+","+rightIndex]=value}return pairs}exports.parse=parseKernTable},{"../check":3,"../parse":9}],20:[function(_dereq_,module,exports){"use strict";var parse=_dereq_("../parse");function parseLocaTable(data,start,numGlyphs,shortVersion){var p,parseFn,glyphOffsets,glyphOffset,i;p=new parse.Parser(data,start);parseFn=shortVersion?p.parseUShort:p.parseULong;glyphOffsets=[];for(i=0;i<numGlyphs+1;i+=1){glyphOffset=parseFn.call(p);if(shortVersion){glyphOffset*=2}glyphOffsets.push(glyphOffset)}return glyphOffsets}exports.parse=parseLocaTable},{"../parse":9}],21:[function(_dereq_,module,exports){"use strict";var parse=_dereq_("../parse");var table=_dereq_("../table");function parseMaxpTable(data,start){var maxp={},p=new parse.Parser(data,start);maxp.version=p.parseVersion();maxp.numGlyphs=p.parseUShort();if(maxp.version===1){maxp.maxPoints=p.parseUShort();maxp.maxContours=p.parseUShort();maxp.maxCompositePoints=p.parseUShort();maxp.maxCompositeContours=p.parseUShort();maxp.maxZones=p.parseUShort();maxp.maxTwilightPoints=p.parseUShort();maxp.maxStorage=p.parseUShort();maxp.maxFunctionDefs=p.parseUShort();maxp.maxInstructionDefs=p.parseUShort();maxp.maxStackElements=p.parseUShort();maxp.maxSizeOfInstructions=p.parseUShort();maxp.maxComponentElements=p.parseUShort();maxp.maxComponentDepth=p.parseUShort()}return maxp}function makeMaxpTable(numGlyphs){return new table.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:numGlyphs}])}exports.parse=parseMaxpTable;exports.make=makeMaxpTable},{"../parse":9,"../table":11}],22:[function(_dereq_,module,exports){"use strict";var encode=_dereq_("../types").encode;var parse=_dereq_("../parse");var table=_dereq_("../table");var nameTableNames=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","licence","licenceURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"];function parseNameTable(data,start){var name={},p=new parse.Parser(data,start);name.format=p.parseUShort();var count=p.parseUShort(),stringOffset=p.offset+p.parseUShort();var platformID,encodingID,languageID,nameID,property,byteLength,offset,str,i,j,codePoints;var unknownCount=0;for(i=0;i<count;i++){platformID=p.parseUShort();encodingID=p.parseUShort();languageID=p.parseUShort();nameID=p.parseUShort();property=nameTableNames[nameID];byteLength=p.parseUShort();offset=p.parseUShort();if(platformID===3&&encodingID===1&&languageID===1033){codePoints=[];var length=byteLength/2;for(j=0;j<length;j++,offset+=2){codePoints[j]=parse.getShort(data,stringOffset+offset)}str=String.fromCharCode.apply(null,codePoints);if(property){name[property]=str}else{unknownCount++;name["unknown"+unknownCount]=str}}}if(name.format===1){name.langTagCount=p.parseUShort()}return name}function makeNameRecord(platformID,encodingID,languageID,nameID,length,offset){return new table.Table("NameRecord",[{name:"platformID",type:"USHORT",value:platformID},{name:"encodingID",type:"USHORT",value:encodingID},{name:"languageID",type:"USHORT",value:languageID},{name:"nameID",type:"USHORT",value:nameID},{name:"length",type:"USHORT",value:length},{name:"offset",type:"USHORT",value:offset}])}function addMacintoshNameRecord(t,recordID,s,offset){var stringBytes=encode.STRING(s);t.records.push(makeNameRecord(1,0,0,recordID,stringBytes.length,offset));t.strings.push(stringBytes);offset+=stringBytes.length;return offset}function addWindowsNameRecord(t,recordID,s,offset){var utf16Bytes=encode.UTF16(s);t.records.push(makeNameRecord(3,1,1033,recordID,utf16Bytes.length,offset));t.strings.push(utf16Bytes);offset+=utf16Bytes.length;return offset}function makeNameTable(options){var i,s;var t=new table.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:0},{name:"stringOffset",type:"USHORT",value:0}]);t.records=[];t.strings=[];var offset=0;for(i=0;i<nameTableNames.length;i+=1){if(options[nameTableNames[i]]!==undefined){s=options[nameTableNames[i]];offset=addMacintoshNameRecord(t,i,s,offset)}}for(i=0;i<nameTableNames.length;i+=1){if(options[nameTableNames[i]]!==undefined){s=options[nameTableNames[i]];offset=addWindowsNameRecord(t,i,s,offset)}}t.count=t.records.length;t.stringOffset=6+t.count*12;for(i=0;i<t.records.length;i+=1){t.fields.push({name:"record_"+i,type:"TABLE",value:t.records[i]})}for(i=0;i<t.strings.length;i+=1){t.fields.push({name:"string_"+i,type:"LITERAL",value:t.strings[i]})}return t}exports.parse=parseNameTable;exports.make=makeNameTable},{"../parse":9,"../table":11,"../types":26}],23:[function(_dereq_,module,exports){"use strict";var parse=_dereq_("../parse");var table=_dereq_("../table");function parseOS2Table(data,start){var os2={},p=new parse.Parser(data,start);os2.version=p.parseUShort();os2.xAvgCharWidth=p.parseShort();os2.usWeightClass=p.parseUShort();os2.usWidthClass=p.parseUShort();os2.fsType=p.parseUShort();os2.ySubscriptXSize=p.parseShort();os2.ySubscriptYSize=p.parseShort();os2.ySubscriptXOffset=p.parseShort();os2.ySubscriptYOffset=p.parseShort();os2.ySuperscriptXSize=p.parseShort();os2.ySuperscriptYSize=p.parseShort();os2.ySuperscriptXOffset=p.parseShort();os2.ySuperscriptYOffset=p.parseShort();os2.yStrikeoutSize=p.parseShort();os2.yStrikeoutPosition=p.parseShort();os2.sFamilyClass=p.parseShort();os2.panose=[];for(var i=0;i<10;i++){os2.panose[i]=p.parseByte()}os2.ulUnicodeRange1=p.parseULong();os2.ulUnicodeRange2=p.parseULong();os2.ulUnicodeRange3=p.parseULong();os2.ulUnicodeRange4=p.parseULong();os2.achVendID=String.fromCharCode(p.parseByte(),p.parseByte(),p.parseByte(),p.parseByte());os2.fsSelection=p.parseUShort();os2.usFirstCharIndex=p.parseUShort();os2.usLastCharIndex=p.parseUShort();os2.sTypoAscender=p.parseShort();os2.sTypoDescender=p.parseShort();os2.sTypoLineGap=p.parseShort();os2.usWinAscent=p.parseUShort();os2.usWinDescent=p.parseUShort();if(os2.version>=1){os2.ulCodePageRange1=p.parseULong();os2.ulCodePageRange2=p.parseULong()}if(os2.version>=2){os2.sxHeight=p.parseShort();os2.sCapHeight=p.parseShort();os2.usDefaultChar=p.parseUShort();os2.usBreakChar=p.parseUShort();os2.usMaxContent=p.parseUShort()}return os2}function makeOS2Table(options){return new table.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:0},{name:"ySubscriptYSize",type:"SHORT",value:0},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:0},{name:"ySuperscriptXSize",type:"SHORT",value:0},{name:"ySuperscriptYSize",type:"SHORT",value:0},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:0},{name:"yStrikeoutSize",type:"SHORT",value:0},{name:"yStrikeoutPosition",type:"SHORT",value:0},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],options)}exports.parse=parseOS2Table;exports.make=makeOS2Table},{"../parse":9,"../table":11}],24:[function(_dereq_,module,exports){"use strict";var encoding=_dereq_("../encoding");var parse=_dereq_("../parse");var table=_dereq_("../table");function parsePostTable(data,start){var post={},p=new parse.Parser(data,start),i,nameLength;post.version=p.parseVersion();post.italicAngle=p.parseFixed();post.underlinePosition=p.parseShort();post.underlineThickness=p.parseShort();post.isFixedPitch=p.parseULong();post.minMemType42=p.parseULong();post.maxMemType42=p.parseULong();post.minMemType1=p.parseULong();post.maxMemType1=p.parseULong();switch(post.version){case 1:post.names=encoding.standardNames.slice();break;case 2:post.numberOfGlyphs=p.parseUShort();post.glyphNameIndex=new Array(post.numberOfGlyphs);for(i=0;i<post.numberOfGlyphs;i++){post.glyphNameIndex[i]=p.parseUShort()}post.names=[];for(i=0;i<post.numberOfGlyphs;i++){if(post.glyphNameIndex[i]>=encoding.standardNames.length){nameLength=p.parseChar();post.names.push(p.parseString(nameLength))}}break;case 2.5:post.numberOfGlyphs=p.parseUShort();post.offset=new Array(post.numberOfGlyphs);for(i=0;i<post.numberOfGlyphs;i++){post.offset[i]=p.parseChar()}break}return post}function makePostTable(){return new table.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}exports.parse=parsePostTable;exports.make=makePostTable},{"../encoding":5,"../parse":9,"../table":11}],25:[function(_dereq_,module,exports){"use strict";var check=_dereq_("../check");var table=_dereq_("../table");var cmap=_dereq_("./cmap");var cff=_dereq_("./cff");var head=_dereq_("./head");var hhea=_dereq_("./hhea");var hmtx=_dereq_("./hmtx");var maxp=_dereq_("./maxp");var _name=_dereq_("./name");var os2=_dereq_("./os2");var post=_dereq_("./post");function log2(v){return Math.log(v)/Math.log(2)|0}function computeCheckSum(bytes){while(bytes.length%4!==0){bytes.push(0)}var sum=0;for(var i=0;i<bytes.length;i+=4){sum+=(bytes[i]<<24)+(bytes[i+1]<<16)+(bytes[i+2]<<8)+bytes[i+3]}sum%=Math.pow(2,32);return sum}function makeTableRecord(tag,checkSum,offset,length){return new table.Table("Table Record",[{name:"tag",type:"TAG",value:tag!==undefined?tag:""},{name:"checkSum",type:"ULONG",value:checkSum!==undefined?checkSum:0},{name:"offset",type:"ULONG",value:offset!==undefined?offset:0},{name:"length",type:"ULONG",value:length!==undefined?length:0}])}function makeSfntTable(tables){var sfnt=new table.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);sfnt.tables=tables;sfnt.numTables=tables.length;var highestPowerOf2=Math.pow(2,log2(sfnt.numTables));sfnt.searchRange=16*highestPowerOf2;sfnt.entrySelector=log2(highestPowerOf2);sfnt.rangeShift=sfnt.numTables*16-sfnt.searchRange;var recordFields=[];var tableFields=[];var offset=sfnt.sizeOf()+makeTableRecord().sizeOf()*sfnt.numTables;while(offset%4!==0){offset+=1;tableFields.push({name:"padding",type:"BYTE",value:0})}for(var i=0;i<tables.length;i+=1){var t=tables[i];check.argument(t.tableName.length===4,"Table name"+t.tableName+" is invalid.");var tableLength=t.sizeOf();var tableRecord=makeTableRecord(t.tableName,computeCheckSum(t.encode()),offset,tableLength);recordFields.push({name:tableRecord.tag+" Table Record",type:"TABLE",value:tableRecord});tableFields.push({name:t.tableName+" table",type:"TABLE",value:t});offset+=tableLength;check.argument(!isNaN(offset),"Something went wrong calculating the offset.");while(offset%4!==0){offset+=1;tableFields.push({name:"padding",type:"BYTE",value:0})}}recordFields.sort(function(r1,r2){if(r1.value.tag>r2.value.tag){return 1}else{return-1}});sfnt.fields=sfnt.fields.concat(recordFields);sfnt.fields=sfnt.fields.concat(tableFields);return sfnt}function metricsForChar(font,chars,notFoundMetrics){for(var i=0;i<chars.length;i+=1){var glyphIndex=font.charToGlyphIndex(chars[i]);if(glyphIndex>0){var glyph=font.glyphs[glyphIndex];return glyph.getMetrics()}}return notFoundMetrics}function charCodeBounds(glyphs){var minCode,maxCode;for(var i=0;i<glyphs.length;i+=1){var glyph=glyphs[i];if(glyph.unicode>=20){if(minCode===undefined){minCode=glyph.unicode}else if(glyph.unicode<minCode){minCode=glyph.unicode}if(maxCode===undefined){maxCode=glyph.unicode}else if(glyph.unicode>maxCode){maxCode=glyph.unicode}}}return[minCode,maxCode]}function average(vs){var sum=0;for(var i=0;i<vs.length;i+=1){sum+=vs[i]}return sum/vs.length}function fontToSfntTable(font){var xMins=[];var yMins=[];var xMaxs=[];var yMaxs=[];var advanceWidths=[];var leftSideBearings=[];var rightSideBearings=[];for(var i=0;i<font.glyphs.length;i+=1){var glyph=font.glyphs[i];if(glyph.name===".notdef")continue;var metrics=glyph.getMetrics();xMins.push(metrics.xMin);yMins.push(metrics.yMin);xMaxs.push(metrics.xMax);yMaxs.push(metrics.yMax);leftSideBearings.push(metrics.leftSideBearing);rightSideBearings.push(metrics.rightSideBearing);advanceWidths.push(glyph.advanceWidth)}var globals={xMin:Math.min.apply(null,xMins),yMin:Math.min.apply(null,yMins),xMax:Math.max.apply(null,xMaxs),yMax:Math.max.apply(null,yMaxs),advanceWidthMax:Math.max.apply(null,advanceWidths),advanceWidthAvg:average(advanceWidths),minLeftSideBearing:Math.min.apply(null,leftSideBearings),maxLeftSideBearing:Math.max.apply(null,leftSideBearings),minRightSideBearing:Math.min.apply(null,rightSideBearings)};globals.ascender=globals.yMax;globals.descender=globals.yMin;var headTable=head.make({unitsPerEm:font.unitsPerEm,xMin:globals.xMin,yMin:globals.yMin,xMax:globals.xMax,yMax:globals.yMax});var hheaTable=hhea.make({ascender:globals.ascender,descender:globals.descender,advanceWidthMax:globals.advanceWidthMax,minLeftSideBearing:globals.minLeftSideBearing,minRightSideBearing:globals.minRightSideBearing,xMaxExtent:globals.maxLeftSideBearing+(globals.xMax-globals.xMin),numberOfHMetrics:font.glyphs.length});var maxpTable=maxp.make(font.glyphs.length);var codeBounds=charCodeBounds(font.glyphs);var os2Table=os2.make({xAvgCharWidth:Math.round(globals.advanceWidthAvg),usWeightClass:500,usWidthClass:5,usFirstCharIndex:codeBounds[0],usLastCharIndex:codeBounds[1],ulUnicodeRange1:1,sTypoAscender:globals.ascender,sTypoDescender:globals.descender,sTypoLineGap:0,usWinAscent:globals.ascender,usWinDescent:-globals.descender,ulCodePageRange1:1,sxHeight:metricsForChar(font,"xyvw",{yMax:0}).yMax,sCapHeight:metricsForChar(font,"HIKLEFJMNTZBDPRAGOQSUVWXY",globals).yMax,usBreakChar:font.hasChar(" ")?32:0});var hmtxTable=hmtx.make(font.glyphs);var cmapTable=cmap.make(font.glyphs);var fullName=font.familyName+" "+font.styleName;var postScriptName=font.familyName.replace(/\s/g,"")+"-"+font.styleName;var nameTable=_name.make({copyright:font.copyright,fontFamily:font.familyName,fontSubfamily:font.styleName,uniqueID:font.manufacturer+":"+fullName,fullName:fullName,version:font.version,postScriptName:postScriptName,trademark:font.trademark,manufacturer:font.manufacturer,designer:font.designer,description:font.description,manufacturerURL:font.manufacturerURL,designerURL:font.designerURL,license:font.license,licenseURL:font.licenseURL,preferredFamily:font.familyName,preferredSubfamily:font.styleName});var postTable=post.make();var cffTable=cff.make(font.glyphs,{version:font.version,fullName:fullName,familyName:font.familyName,weightName:font.styleName,postScriptName:postScriptName});var tables=[headTable,hheaTable,maxpTable,os2Table,nameTable,cmapTable,postTable,cffTable,hmtxTable];var sfntTable=makeSfntTable(tables);var bytes=sfntTable.encode();var checkSum=computeCheckSum(bytes);headTable.checkSumAdjustment=2981146554-checkSum;sfntTable=makeSfntTable(tables);return sfntTable}exports.computeCheckSum=computeCheckSum;exports.make=makeSfntTable;exports.fontToTable=fontToSfntTable},{"../check":3,"../table":11,"./cff":12,"./cmap":13,"./head":16,"./hhea":17,"./hmtx":18,"./maxp":21,"./name":22,"./os2":23,"./post":24}],26:[function(_dereq_,module,exports){"use strict";var check=_dereq_("./check");var LIMIT16=32768;var LIMIT32=2147483648;var decode={};var encode={};var sizeOf={};function constant(v){return function(){return v}}encode.BYTE=function(v){check.argument(v>=0&&v<=255,"Byte value should be between 0 and 255.");return[v]};sizeOf.BYTE=constant(1);encode.CHAR=function(v){return[v.charCodeAt(0)]};sizeOf.BYTE=constant(1);encode.CHARARRAY=function(v){var b=[];for(var i=0;i<v.length;i+=1){b.push(v.charCodeAt(i))}return b};sizeOf.CHARARRAY=function(v){return v.length};encode.USHORT=function(v){return[v>>8&255,v&255]};sizeOf.USHORT=constant(2);encode.SHORT=function(v){if(v>=LIMIT16){v=-(2*LIMIT16-v)}return[v>>8&255,v&255]};sizeOf.SHORT=constant(2);encode.UINT24=function(v){return[v>>16&255,v>>8&255,v&255]};sizeOf.UINT24=constant(3);encode.ULONG=function(v){return[v>>24&255,v>>16&255,v>>8&255,v&255]};sizeOf.ULONG=constant(4);encode.LONG=function(v){if(v>=LIMIT32){v=-(2*LIMIT32-v)}return[v>>24&255,v>>16&255,v>>8&255,v&255]};sizeOf.LONG=constant(4);encode.FIXED=encode.ULONG;sizeOf.FIXED=sizeOf.ULONG;encode.FWORD=encode.SHORT;sizeOf.FWORD=sizeOf.SHORT;encode.UFWORD=encode.USHORT;sizeOf.UFWORD=sizeOf.USHORT;encode.LONGDATETIME=function(){return[0,0,0,0,0,0,0,0]};sizeOf.LONGDATETIME=constant(8);encode.TAG=function(v){check.argument(v.length===4,"Tag should be exactly 4 ASCII characters.");return[v.charCodeAt(0),v.charCodeAt(1),v.charCodeAt(2),v.charCodeAt(3)]};sizeOf.TAG=constant(4);encode.Card8=encode.BYTE;sizeOf.Card8=sizeOf.BYTE;encode.Card16=encode.USHORT;sizeOf.Card16=sizeOf.USHORT;encode.OffSize=encode.BYTE;sizeOf.OffSize=sizeOf.BYTE;encode.SID=encode.USHORT;sizeOf.SID=sizeOf.USHORT;encode.NUMBER=function(v){if(v>=-107&&v<=107){return[v+139]}else if(v>=108&&v<=1131){v=v-108;return[(v>>8)+247,v&255]}else if(v>=-1131&&v<=-108){v=-v-108;return[(v>>8)+251,v&255]}else if(v>=-32768&&v<=32767){return encode.NUMBER16(v)}else{return encode.NUMBER32(v)}};sizeOf.NUMBER=function(v){return encode.NUMBER(v).length};encode.NUMBER16=function(v){return[28,v>>8&255,v&255]};sizeOf.NUMBER16=constant(2);encode.NUMBER32=function(v){return[29,v>>24&255,v>>16&255,v>>8&255,v&255]};sizeOf.NUMBER32=constant(4);encode.NAME=encode.CHARARRAY;sizeOf.NAME=sizeOf.CHARARRAY;encode.STRING=encode.CHARARRAY;sizeOf.STRING=sizeOf.CHARARRAY;encode.UTF16=function(v){var b=[];for(var i=0;i<v.length;i+=1){b.push(0);b.push(v.charCodeAt(i))}return b};sizeOf.UTF16=function(v){return v.length*2};encode.INDEX=function(l){var offSize,offset,offsets,offsetEncoder,encodedOffsets,encodedOffset,data,dataSize,i,v;offset=1;offsets=[offset];data=[];dataSize=0;for(i=0;i<l.length;i+=1){v=encode.OBJECT(l[i]);Array.prototype.push.apply(data,v);dataSize+=v.length;offset+=v.length;offsets.push(offset)}if(data.length===0){return[0,0]}encodedOffsets=[];offSize=1+Math.floor(Math.log(dataSize)/Math.log(2))/8|0;offsetEncoder=[undefined,encode.BYTE,encode.USHORT,encode.UINT24,encode.ULONG][offSize];for(i=0;i<offsets.length;i+=1){encodedOffset=offsetEncoder(offsets[i]);Array.prototype.push.apply(encodedOffsets,encodedOffset)}return Array.prototype.concat(encode.Card16(l.length),encode.OffSize(offSize),encodedOffsets,data)};sizeOf.INDEX=function(v){return encode.INDEX(v).length};encode.DICT=function(m){var d=[];var keys=Object.keys(m);for(var i=0;i<keys.length;i+=1){var k=parseInt(keys[i],0);var v=m[k];d=d.concat(encode.OPERAND(v.value,v.type));d=d.concat(encode.OPERATOR(k))}return d};sizeOf.DICT=function(m){return encode.DICT(m).length};encode.OPERATOR=function(v){if(v<1200){return[v]}else{return[12,v-1200]}};encode.OPERAND=function(v,type){var d,i;d=[];if(Array.isArray(type)){for(i=0;i<type.length;i+=1){check.argument(v.length===type.length,"Not enough arguments given for type"+type);d=d.concat(encode.OPERAND(v[i],type[i]))}}else{if(type==="SID"){d=d.concat(encode.NUMBER(v))}else if(type==="offset"){d=d.concat(encode.NUMBER32(v))}else{d=d.concat(encode.NUMBER(v))}}return d};encode.OP=encode.BYTE;sizeOf.OP=sizeOf.BYTE;encode.CHARSTRING=function(ops){var d=[],i;for(i=0;i<ops.length;i+=1){var op=ops[i];var encodingFunction=encode[op.type];d=d.concat(encodingFunction(op.value))}return d};sizeOf.CHARSTRING=function(ops){return encode.CHARSTRING(ops).length};encode.OBJECT=function(v){var encodingFunction=encode[v.type];check.argument(encodingFunction!==undefined,"No encoding function for type "+v.type);return encodingFunction(v.value)};encode.TABLE=function(table){var d=[];for(var i=0;i<table.fields.length;i+=1){var field=table.fields[i];var encodingFunction=encode[field.type];check.argument(encodingFunction!==undefined,"No encoding function for field type "+field.type);var value=table[field.name];if(value===undefined){value=field.value}var bytes=encodingFunction(value);d=d.concat(bytes)}return d};encode.LITERAL=function(v){return v};sizeOf.LITERAL=function(v){return v.length};exports.decode=decode;exports.encode=encode;exports.sizeOf=sizeOf},{"./check":3}]},{},[8])(8)});